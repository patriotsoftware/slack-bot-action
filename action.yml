name: "slack-bot-action"
description: "Sends custom message to person or channel of your choice"

inputs:
  destination:
    description: "Channel or user that will receive message."
    required: true
  message:
    description: "Message that will be sent."
    required: true
    default: "testing"
  slack-token:
    description: "Slack Token, can be stored as a secret in the repo."
    required: false
  results:
    description: "List of job results to append to the message. New line separated with:  job:result"
    required: false
  github-token:
    description: "GitHub Repository to for getting commit email. Use: secrets.GITHUB_TOKEN "
    required: false
  github-repository:
    description: "GitHub Repository to for getting commit email. Default: github.repository"
    required: false
  github-sha:
    description: "GitHub SHA to for getting commit email. Default: github.sha"
    required: false
  remove-branch-prefix:
    description: "Removes branch /refs/head/ from string instances of /refs/heads. Values: true/false"
    required: false
    default: "true"
  fallback-destination:
    description: "Destination to use if any of the destinations fail."
    required: false
runs:
  using: composite
  steps:
  - name: Download slack-bot release
    uses: robinraju/release-downloader@v1
    with:
      repository: patriotsoftware/slack-bot-action
      latest: true
      fileName: slack-bot
  - uses: octokit/request-action@v2.x
    id: get_commit_email
    with:
      route: GET /repos/${{ github.repository }}/commits/${{ github.sha }}
    env:
      GITHUB_TOKEN: ${{ github.token }}
  - run: "echo data: '${{ fromJson(steps.get_commit_email.outputs.data).commit.committer.email }}'"
    shell: bash
  # - name: Run slack-bot
  #   shell: bash
  #   env:
  #     # INPUT_DESTINATION: ${{ inputs.destination }}
  #     INPUT_DESTINATION: ${{ fromJson(steps.get_commit_email.outputs.data).committer.email }}
  #     INPUT_MESSAGE: ${{ inputs.message }}
  #     INPUT_SLACK-TOKEN: ${{ inputs.slack-token }}
  #     INPUT_RESULTS: ${{ inputs.results }}
  #     INPUT_GITHUB-TOKEN: ${{ github.token }}
  #     INPUT_GITHUB-REPOSITORY: ${{ github.repository }}
  #     INPUT_GITHUB-SHA: ${{ github.sha }}
  #     INPUT_REMOVE-BRANCH-PREFIX: ${{ inputs.remove-branch-prefix }}
  #     INPUT_FALLBACK-DESTINATION: ${{ inputs.fallback-destination }}
  #   run: |
  #     chmod +x slack-bot
  #     ./slack-bot
